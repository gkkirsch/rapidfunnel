!function(){"use strict";function e(e,t){e?(console.log(`Redirecting to: ${e} ${"_blank"===t?"(new tab)":"(same tab)"}`),"_blank"===t?window.open(e,"_blank"):window.location.href=e):console.log("No redirect URL specified.")}function t(t){async function n(e){console.log("Sending CTA notification:",e);try{const t=await fetch("https://app.rapidfunnel.com/api/mail/send-cta-email",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)});if(t.ok){const e=await t.json();return console.log("CTA notification sent successfully",e),e}{let e="Could not read error response.";try{e=await t.json()}catch(e){console.warn("Could not parse error response body as JSON.")}console.error(`CTA notification failed: ${t.status} ${t.statusText}`,e)}}catch(e){console.error("Error sending CTA notification:",e)}}const o=window.rapidFunnelPageName||window.location.pathname,a=document.querySelectorAll("a, button");0!==a.length?(console.log(`Found ${a.length} potential trackable elements (links/buttons). Initializing tracking...`),a.forEach((a=>{a.addEventListener("click",(async i=>{const r=function(e){let t=e.getAttribute("data-description")||e.getAttribute("aria-label")||e.innerText||e.textContent;return"BUTTON"===e.tagName&&(t=t||e.value||e.name),t=t?t.trim():"",t||(t="A"===e.tagName?"Unnamed Link":"Unnamed Button"),t.length>100&&(t=t.substring(0,97)+"..."),t}(a);if(console.log(`Click detected on ${a.tagName}: "${r}"`),"BUTTON"===a.tagName){if(a.closest("form")&&("submit"===a.type||!a.hasAttribute("type")))return void console.log("Ignoring click on form submit button for CTA tracking.")}if(!t.userId)return void console.warn("Skipping CTA notification: Missing userId.");let c={legacyUserId:Number(t.userId),contactFirstName:"N/A",contactLastName:"N/A",contactPhoneNumber:"N/A",contactEmail:"N/A",ctaLocation:r,ctaPageName:o};if("A"===a.tagName){i.preventDefault(),console.log("[CTA Link] Event prevented.");const o=a.getAttribute("href"),r=a.getAttribute("target")||"_self";if(t.contactId){console.log("[CTA Link] Before await getContactDetails.");const e=await async function(e){if(!e)return console.warn("Invalid or missing contactId for fetching details."),null;const t=`https://apiv2.rapidfunnel.com/v2/contact-details/${e}`;console.log(`Fetching contact details for ID: ${e}`);try{const e=await fetch(t);if(!e.ok)return console.error(`Failed to fetch contact details: ${e.status} ${e.statusText}`),null;const n=await e.json();return n&&n.data?(console.log("Contact details fetched successfully:",n.data),n.data):(console.warn("Contact details response format unexpected:",n),null)}catch(e){return console.error("Error fetching contact details:",e),null}}(t.contactId);console.log("[CTA Link] After await getContactDetails. Details:",e),e?(c.contactFirstName=e.firstName||"N/A",c.contactLastName=e.lastName||"N/A",c.contactPhoneNumber=e.phone||"N/A",c.contactEmail=e.email||"N/A"):(c.contactFirstName="System failed to retrieve",c.contactLastName=`Contact ID: ${t.contactId}`)}else c.contactFirstName="No contact ID found",console.log("[CTA Link] No contactId to fetch.");try{console.log("[CTA Link] Before await sendCtaNotification."),await n(c),console.log("[CTA Link] After await sendCtaNotification.")}catch(e){console.error("[CTA Link] Notification sending failed (handled).",e)}finally{console.log("[CTA Link] Inside finally block, before handleRedirect."),e(o,r),console.log("[CTA Link] Inside finally block, after handleRedirect call.")}}else"BUTTON"===a.tagName&&n(c).then((()=>{const t=a.getAttribute("data-href"),n=a.getAttribute("data-target");t&&(console.log("Handling custom redirect for button:",t),e(t,n||"_self"))})).catch((e=>{console.error("Notification sending failed (button click).")}))}))}))):console.log("No trackable links or buttons found.")}function n(e){console.log("Initializing Video Tracking...",e),void 0!==window._wq?(window._wq=window._wq||[],window._wq.push({_all:function(t){console.log("Wistia video found:",t.hashedId()),t.bind("play",(()=>{console.log("Video play event detected for:",t.hashedId());const{userId:n,resourceId:o,contactId:a}=e,i=e=>e&&/^[0-9]+$/.test(e);if(!i(n)||!i(o)||!i(a))return void console.warn("Cannot track video play: Missing or non-numeric userId, resourceId, or contactId in URL params.");const r=document.getElementById("webinar");!async function(e){const t="https://my.rapidfunnel.com/landing/resource/push-to-sqs",n=new URLSearchParams(e).toString();console.log("Sending video play data to:",t),console.log("Request Body (URL-encoded):",n);try{const e=await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/javascript, */*; q=0.01","X-Requested-With":"XMLHttpRequest"},body:n});if(e.ok){const t=e.headers.get("content-type");if(t&&-1!==t.indexOf("application/json")){const t=await e.json();console.log("Video tracking submitted successfully:",t),t||console.warn("Video tracking API returned a falsy response.")}else console.log("Video tracking submitted successfully (non-JSON response).")}else{let t="Could not read error response.";try{t=await e.json()}catch(e){}console.error(`Video tracking submission failed: ${e.status} ${e.statusText}`,t)}}catch(e){console.error("Error sending video tracking data:",e)}}({resourceId:o,contactId:a,userId:n,percentageWatched:0,mediaHash:t.hashedId(),duration:t.duration(),visitorKey:t.visitorKey(),eventKey:t.eventKey(),delayProcess:1,webinar:r?r.value:""})}))}}),console.log("Wistia video tracking initialized. Waiting for play events...")):console.log("Wistia Player API (_wq) not found. Skipping video tracking initialization.")}function o(e){console.log("Initializing Form Tracking with event delegation (listening on document)."),document.addEventListener("submit",(async t=>{if(!(t.target instanceof HTMLFormElement))return;const n=t.target;console.log("Submit event caught by delegate listener for form:",n.id||"Unnamed form");const o=function(e){const t={firstNameInput:null,lastNameInput:null,nameInput:null,emailInput:null,phoneInput:null};t.emailInput=e.querySelector('input[type="email"]'),t.phoneInput=e.querySelector('input[type="tel"]');const n={firstName:[/first.?name/i,/fname/i,/first_name/i,/first-name/i,/firstname/i],lastName:[/last.?name/i,/lname/i,/surname/i,/last_name/i,/last-name/i],name:[/^name$/i,/full.?name/i,/your.?name/i],email:[/e.?mail/i],phone:[/phone/i,/mobile/i,/contact.?number/i]},o=["id","name","class","placeholder","aria-label"],a=new Set;for(const i in n){const r=`${i}Input`;t[r]&&"email"!==i&&"phone"!==i||n[i].some((n=>Array.from(e.elements).some((e=>!a.has(e)&&!!["text","email","tel","hidden"].includes(e.type.toLowerCase())&&o.some((o=>{const c=e.getAttribute(o);return!(!c||!n.test(c)||"email"===i&&t.emailInput===e||"phone"===i&&t.phoneInput===e||(t[r]=e,a.add(e),0))}))))))}return t.emailInput||t.phoneInput?(console.log("Identified potential contact fields in form:",e.id||"Unnamed",t),t):(console.log("Form cannot be tracked (missing email and phone): ",e.id||"Unnamed"),null)}(n);if(o){console.log("Trackable form identified (has email/phone). Processing submission..."),t.preventDefault(),console.log("Default submission prevented for:",n.id||"Unnamed form");const{firstNameInput:a,lastNameInput:i,nameInput:r,emailInput:c,phoneInput:s}=o,l=c?.value?.trim(),d=s?.value?.trim();if(!l&&!d){console.warn("Form submission stopped: Missing both email and phone value.");const e=n.querySelector('[type="submit"]');return void(e&&(e.disabled=!1))}if(l&&!/\S+@\S+\.\S+/.test(l)){console.warn("Form submission stopped: Invalid email format.");const e=n.querySelector('[type="submit"]');return void(e&&(e.disabled=!1))}let u="",m="";if(a?.value&&i?.value)u=a.value.trim(),m=i.value.trim();else if(r?.value){const e=r.value.trim().split(/\s+/);u=e.shift()||"",m=e.join(" ")}else a?.value?u=a.value.trim():i?.value&&(u=i.value.trim());const g={};u&&(g.firstName=u),m&&(g.lastName=m),l&&(g.email=l),d&&(g.phone=d),g.campaign=window.rapidFunnelCampaignId||0,g.contactTag=window.rapidFunnelLabelId||0;const f=new URLSearchParams(g).toString();if(!e.userId||!e.resourceId)return void console.error("Cannot submit form: Missing userId or resourceId in URL.");const p=Number(e.resourceId),h=Number(e.userId),w=n.querySelector('[type="submit"]');w&&(w.disabled=!0);const b=await async function(e,t,n){const o="https://my.rapidfunnel.com/landing/resource/create-custom-contact",a=new URLSearchParams;a.append("formData",e),a.append("resourceId",t),a.append("senderId",n);let i=window.location.href;i.startsWith("file://")&&(i="customPage"),a.append("sentFrom",i);const r=a.toString();console.log("Submitting contact form data to:",o),console.log("Request Body (URL-encoded):",r);try{const e=await fetch(o,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/javascript, */*; q=0.01"},body:r});if(!e.ok){let t="Could not read error response.";try{t=await e.json()}catch(e){}return console.error(`Contact form submission failed: ${e.status} ${e.statusText}`,t),null}const a=await e.json();console.log("Contact form submitted successfully:",a);const i=a.contactId||null;if(!i||i<=0)return console.error("Form submitted but no valid contactId received.",a),null;let c=window.rapidFunnelNextPage;if(!c){const e=document.getElementById("contactFormSubmitContainer");e&&(c=e.getAttribute("data-redirect"))}if(c){console.log("Redirect URL found:",c);try{const e=new URL(c,window.location.origin);e.searchParams.set("userId",String(n)),e.searchParams.set("resourceId",String(t)),e.searchParams.set("contactId",String(i)),console.log("Redirecting to:",e.toString()),window.location.href=e.toString()}catch(e){console.error("Error constructing redirect URL:",e)}}else console.log("No redirect URL specified. Staying on page.");return i}catch(e){return console.error("Error submitting contact form:",e),null}}(f,p,h);!w||b&&(window.rapidFunnelNextPage||document.getElementById("contactFormSubmitContainer")?.getAttribute("data-redirect"))||(console.log("Re-enabling submit button."),w.disabled=!1)}else console.log("Form submitted but not tracked (missing email/phone):",n.id||"Unnamed form")}))}function a(){console.log("Running initialization logic...");const e=function(){const e=new URLSearchParams(window.location.search);return{userId:e.get("userId"),resourceId:e.get("resourceId"),contactId:e.get("contactId")}}();console.log("RapidFunnel Tracker Initialized. Params:",e),e.userId&&e.resourceId||console.warn("RapidFunnel Tracker: userId or resourceId missing from URL parameters. Tracking might be limited."),t(e),n(e),o(e)}if(console.log("RapidFunnel Tracker: Script file executing..."),"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll)console.log("DOM ready on initial check (readyState). Running initializers."),a();else if(document.body)console.log("DOM body found on initial check. Running initializers."),a();else{console.log("DOM not ready, setting up interval check for document.body.");let e=null,t=50;const n=()=>{t--,(document.body||t<=0)&&(console.log(t>0?"document.body found by polling.":"Polling timeout reached."),clearInterval(e),window.rfTrackerInitialized||(window.rfTrackerInitialized=!0,a()))};document.addEventListener("DOMContentLoaded",(()=>{console.log("DOMContentLoaded event fired (fallback)."),clearInterval(e),window.rfTrackerInitialized||(window.rfTrackerInitialized=!0,a())})),e=setInterval(n,100)}}();