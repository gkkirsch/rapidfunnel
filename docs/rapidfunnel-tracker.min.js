!function(){"use strict";function t(t,e){t?(console.log(`Redirecting to: ${t} ${"_blank"===e?"(new tab)":"(same tab)"}`),"_blank"===e?window.open(t,"_blank"):window.location.href=t):console.log("No redirect URL specified.")}function e(e){async function o(t){console.log("Sending CTA notification:",t);try{const e=await fetch("https://app.rapidfunnel.com/api/mail/send-cta-email",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)});if(e.ok){const t=await e.json();return console.log("CTA notification sent successfully",t),t}{let t="Could not read error response.";try{t=await e.json()}catch(t){console.warn("Could not parse error response body as JSON.")}console.error(`CTA notification failed: ${e.status} ${e.statusText}`,t)}}catch(t){console.error("Error sending CTA notification:",t)}}async function n(t){if(!t)return console.warn("Invalid or missing contactId for fetching details."),null;const e=`https://apiv2.rapidfunnel.com/v2/contact-details/${t}`;console.log(`Fetching contact details for ID: ${t}`);try{const t=await fetch(e);if(!t.ok)return console.error(`Failed to fetch contact details: ${t.status} ${t.statusText}`),null;const o=await t.json();return o&&o.data?(console.log("Contact details fetched successfully:",o.data),o.data):(console.warn("Contact details response format unexpected:",o),null)}catch(t){return console.error("Error fetching contact details:",t),null}}const a=window.rapidFunnelPageName||window.location.pathname,i=document.querySelectorAll("a, button");0!==i.length?(console.log(`Found ${i.length} potential trackable elements (links/buttons). Initializing tracking...`),i.forEach((i=>{i.addEventListener("click",(async c=>{const r=function(t){let e=t.getAttribute("data-description")||t.getAttribute("aria-label")||t.innerText||t.textContent;return"BUTTON"===t.tagName&&(e=e||t.value||t.name),e=e?e.trim():"",e||(e="A"===t.tagName?"Unnamed Link":"Unnamed Button"),e.length>100&&(e=e.substring(0,97)+"..."),e}(i);if(console.log(`Click detected on ${i.tagName}: "${r}"`),e.userId&&e.resourceId){if("BUTTON"===i.tagName){if("submit"===i.type||!i.hasAttribute("type")&&i.closest("form")){console.log("[Submit Button] Click detected."),c.preventDefault(),console.log("[Submit Button] Default action prevented.");const t=function(){const t={firstNameInput:null,lastNameInput:null,nameInput:null,emailInput:null,phoneInput:null};t.emailInput=document.querySelector('input[type="email"]'),t.phoneInput=document.querySelector('input[type="tel"]');const e={firstName:[/first.?name/i,/fname/i,/first_name/i,/first-name/i,/firstname/i],lastName:[/last.?name/i,/lname/i,/surname/i,/last_name/i,/last-name/i],name:[/^name$/i,/full.?name/i,/your.?name/i],email:[/e.?mail/i],phone:[/phone/i,/mobile/i,/contact.?number/i]},o=["id","name","class","placeholder","aria-label"],n=new Set,a=document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="hidden"], textarea');for(const i in e){const c=`${i}Input`;t[c]&&"email"!==i&&"phone"!==i||e[i].some((e=>Array.from(a).some((a=>!n.has(a)&&o.some((o=>{const r=a.getAttribute(o);return!(!r||!e.test(r)||"email"===i&&t.emailInput===a||"phone"===i&&t.phoneInput===a||(t[c]=a,n.add(a),0))}))))))}return t.emailInput||t.phoneInput?(console.log("Identified potential contact inputs on the page:",t),t):(console.log("Could not find trackable inputs (email or phone) anywhere on the page."),null)}();if(t){console.log("[Submit Button] Found trackable inputs on page.");const{firstNameInput:o,lastNameInput:n,nameInput:a,emailInput:c,phoneInput:r}=t,s=c?.value?.trim(),l=r?.value?.trim();if(!s&&!l)return void console.warn("[Submit Button] Submission stopped: Missing both email and phone value on page.");if(s&&!/\S+@\S+\.\S+/.test(s))return void console.warn("[Submit Button] Submission stopped: Invalid email format.");let d="",u="";if(o?.value&&n?.value)d=o.value.trim(),u=n.value.trim();else if(a?.value){const t=a.value.trim().split(/\s+/);d=t.shift()||"",u=t.join(" ")}else o?.value?d=o.value.trim():n?.value&&(d=n.value.trim());const m={};d&&(m.firstName=d),u&&(m.lastName=u),s&&(m.email=s),l&&(m.phone=l),m.campaign=window.rapidFunnelCampaignId||0,m.contactTag=window.rapidFunnelLabelId||0;const g=new URLSearchParams(m).toString(),p=Number(e.resourceId),f=Number(e.userId);i.disabled=!0,console.log("[Submit Button] Disabled.");const h=await async function(t,e,o){const n="https://my.rapidfunnel.com/landing/resource/create-custom-contact",a=new URLSearchParams;a.append("formData",t),a.append("resourceId",e),a.append("senderId",o);let i="customPage";i.startsWith("file://")&&(i="customPage"),a.append("sentFrom",i);const c=a.toString();console.log("Submitting page contact data to:",n),console.log("Request Body (URL-encoded):",c);try{const t=await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/javascript, */*; q=0.01"},body:c});if(!t.ok){let e="Could not read error response.";try{e=await t.json()}catch(t){}return console.error(`Contact data submission failed: ${t.status} ${t.statusText}`,e),null}const e=await t.json();console.log("Contact data submitted successfully:",e);const o=e.contactId||null;return!o||o<=0?(console.error("Submission successful but no valid contactId received.",e),null):o}catch(t){return console.error("Error submitting contact data:",t),null}}(g,p,f),I=i.getAttribute("data-redirect");let b=!1;if(h&&I){console.log("[Submit Button] Redirect URL found on button:",I);try{const t=new URL(I,window.location.origin);t.searchParams.set("userId",String(f)),t.searchParams.set("resourceId",String(p)),t.searchParams.set("contactId",String(h)),console.log("[Submit Button] Redirecting to:",t.toString()),window.location.href=t.toString(),b=!0}catch(t){console.error("[Submit Button] Error constructing redirect URL:",t)}}else h?console.log("[Submit Button] Submission successful, but no data-redirect found on button. Staying on page."):console.warn("[Submit Button] Submission failed or returned invalid contactId.");b||(console.log("[Submit Button] Re-enabling button."),i.disabled=!1)}else console.warn("[Submit Button] Clicked, but no trackable inputs (email/phone) found on the page. No action taken.")}else{console.log("[CTA Button] Click detected.");let c={legacyUserId:Number(e.userId),contactFirstName:"N/A",contactLastName:"N/A",contactPhoneNumber:"N/A",contactEmail:"N/A",ctaLocation:r,ctaPageName:a};if(e.contactId){const t=await n(e.contactId);t?(c.contactFirstName=t.firstName||"N/A",c.contactLastName=t.lastName||"N/A",c.contactPhoneNumber=t.phone||"N/A",c.contactEmail=t.email||"N/A"):(c.contactFirstName="System failed to retrieve",c.contactLastName=`Contact ID: ${e.contactId}`)}else c.contactFirstName="No contact ID found";const s=o(c),l=i.getAttribute("data-href"),d=i.getAttribute("data-target")||"_self";if(l){console.log("[CTA Button] Found data-href, will redirect after notification attempt.");try{await s}catch(t){}t(l,d)}else console.log("[CTA Button] No data-href found. Allowing default button action (if any) after notification attempt.")}}else if("A"===i.tagName){console.log("[CTA Link] Click detected."),c.preventDefault(),console.log("[CTA Link] Default navigation prevented.");const s=i.getAttribute("href"),l=i.getAttribute("target")||"_self";let d={legacyUserId:Number(e.userId),contactFirstName:"N/A",contactLastName:"N/A",contactPhoneNumber:"N/A",contactEmail:"N/A",ctaLocation:r,ctaPageName:a};if(e.contactId){const t=await n(e.contactId);t?(d.contactFirstName=t.firstName||"N/A",d.contactLastName=t.lastName||"N/A",d.contactPhoneNumber=t.phone||"N/A",d.contactEmail=t.email||"N/A"):(d.contactFirstName="System failed to retrieve",d.contactLastName=`Contact ID: ${e.contactId}`)}else d.contactFirstName="No contact ID found";try{console.log("[CTA Link] Sending notification..."),await o(d),console.log("[CTA Link] Notification sent (or attempt finished).")}catch(t){console.error("[CTA Link] Notification sending failed (error caught).",t)}finally{console.log("[CTA Link] Proceeding to redirect."),t(s,l)}}}else console.warn("Skipping action: Missing userId or resourceId in URL params.")}))}))):console.log("No trackable links or buttons found.")}function o(){console.log("Running initialization logic...");const t=function(){const t=new URLSearchParams(window.location.search);return{userId:t.get("userId"),resourceId:t.get("resourceId"),contactId:t.get("contactId")}}();console.log("URL Parameters:",t),function(t){const{userId:e,contactId:o}=t;document.querySelectorAll("[href]").forEach((t=>{let n=t.href,a=!1;e&&n.includes("[user-id]")&&(n=n.replace(/\[user-id\]/g,e),a=!0),n.includes("[contact-id]")&&(n=n.replace(/\[contact-id\]/g,o||""),a=!0),a&&(t.href=n,console.log(`Updated URL: ${t.href}`))})),document.querySelectorAll("[src]").forEach((t=>{let n=t.src,a=!1;e&&n.includes("[user-id]")&&(n=n.replace(/\[user-id\]/g,e),a=!0),n.includes("[contact-id]")&&(n=n.replace(/\[contact-id\]/g,o||""),a=!0),a&&(t.src=n,console.log(`Updated source: ${t.src}`))})),document.querySelectorAll("*").forEach((t=>{Array.from(t.attributes).forEach((n=>{if(n.name.startsWith("data-")&&"string"==typeof n.value){let a=n.value,i=!1;e&&a.includes("[user-id]")&&(a=a.replace(/\[user-id\]/g,e),i=!0),a.includes("[contact-id]")&&(a=a.replace(/\[contact-id\]/g,o||""),i=!0),i&&(t.setAttribute(n.name,a),console.log(`Updated data attribute: ${n.name}`))}}))}))}(t);try{e(t)}catch(t){console.error("Failed to initialize CTA tracking:",t)}try{!function(t){function e(t){if(void 0!==window._wq)return console.log("Wistia API already available"),void t();console.log("Waiting for Wistia API to load...");let e=setInterval((()=>{void 0!==window._wq&&(clearInterval(e),console.log("Wistia API loaded"),t())}),100);setTimeout((()=>{clearInterval(e),console.warn("Wistia API failed to load after 10 seconds")}),1e4)}async function o(t){try{const e=await fetch("https://my.rapidfunnel.com/landing/resource/push-to-sqs",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"},body:new URLSearchParams(t).toString()});if(!e.ok)return void console.error(`Video tracking submission failed: ${e.status} ${e.statusText}`);const o=e.headers.get("content-type");if(o&&o.includes("application/json")){const t=await e.json();console.log("Video tracking submitted successfully:",t)}else console.log("Video tracking submitted successfully")}catch(t){console.error("Error sending video tracking data:",t)}}console.log("Initializing Video Tracking...",t),new Promise(((t,o)=>{if(void 0!==window._wq)return console.log("Wistia API already loaded"),void t();if(document.querySelector('script[src*="wistia.com/assets/external/E-v1.js"]'))return console.log("Wistia script already loading"),void e(t);console.log("Loading Wistia script...");const n=document.createElement("script");n.src="https://fast.wistia.com/assets/external/E-v1.js",n.async=!0,n.onload=()=>{console.log("Wistia script loaded successfully"),e(t)},n.onerror=t=>{console.error("Failed to load Wistia script:",t),o(new Error("Failed to load Wistia script"))},document.head.appendChild(n)})).then((()=>{window._wq=window._wq||[],window._wq.push({_all:function(e){console.log("Wistia video found:",e.hashedId()),e.bind("play",(()=>{console.log("Video play event detected for:",e.hashedId());const{userId:n,resourceId:a,contactId:i}=t,c=t=>t&&/^[0-9]+$/.test(t);c(n)&&c(i)?o({resourceId:a,contactId:i,userId:n,percentageWatched:0,mediaHash:e.hashedId(),duration:e.duration(),visitorKey:e.visitorKey(),eventKey:e.eventKey(),delayProcess:1,webinar:""}):console.warn("Cannot track video play: Missing or non-numeric userId, resourceId, or contactId in URL params.")}));const n=[25,50,75,100];let a=0,i=!1;e.bind("end",(()=>{if(console.log(`Video ${e.hashedId()} ended, resetting progress tracking`),a<100){const{userId:n,resourceId:a,contactId:i}=t;o({resourceId:a,contactId:i,userId:n,percentageWatched:1,mediaHash:e.hashedId(),duration:e.duration(),visitorKey:e.visitorKey(),eventKey:e.eventKey(),delayProcess:1,webinar:""})}a=0,i=!0})),e.bind("pause",(()=>{console.log(`Video ${e.hashedId()} paused at ${Math.round(e.time()/e.duration()*100)}%`)})),e.bind("play",(()=>{i=!1})),e.bind("timechange",(()=>{if(i)return;const c=e.time(),r=e.duration();if(!r||isNaN(c)||isNaN(r))return;const s=Math.min(100,Math.max(0,Math.round(c/r*100)));for(const i of n)if(s>=i&&a<i){console.log(`Video ${e.hashedId()} reached ${i}% watched (current: ${s}%, last reported: ${a}%)`);const{userId:n,resourceId:c,contactId:r}=t;o({resourceId:c,contactId:r,userId:n,percentageWatched:i/100,mediaHash:e.hashedId(),duration:e.duration(),visitorKey:e.visitorKey(),eventKey:e.eventKey(),delayProcess:1,webinar:""}),a=i;break}}))}}),console.log("Wistia video tracking initialized. Waiting for play events...")})).catch((t=>{console.error("Failed to initialize Wistia tracking:",t)}))}(t)}catch(t){console.error("Failed to initialize video tracking:",t)}try{t.contactId&&console.log("Contact ID found in URL, ensuring form buttons track as CTAs.",t.contactId)}catch(t){console.error("Error handling form with existing contact:",t)}}if(console.log("RapidFunnel Tracker: Script file executing..."),"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll)console.log("DOM ready on initial check (readyState). Running initializers."),o();else if(document.body)console.log("DOM body found on initial check. Running initializers."),o();else{console.log("DOM not ready, setting up interval check for document.body.");let t=null,e=50;const n=()=>{e--,(document.body||e<=0)&&(console.log(e>0?"document.body found by polling.":"Polling timeout reached."),clearInterval(t),window.rfTrackerInitialized||(window.rfTrackerInitialized=!0,o()))};document.addEventListener("DOMContentLoaded",(()=>{console.log("DOMContentLoaded event fired (fallback)."),clearInterval(t),window.rfTrackerInitialized||(window.rfTrackerInitialized=!0,o())})),t=setInterval(n,100)}}();