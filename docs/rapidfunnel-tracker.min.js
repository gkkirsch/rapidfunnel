!function(){"use strict";function e(e,t){e?(console.log(`Redirecting to: ${e} ${"_blank"===t?"(new tab)":"(same tab)"}`),"_blank"===t?window.open(e,"_blank"):window.location.href=e):console.log("No redirect URL specified.")}function t(t){async function o(e){console.log("Sending CTA notification:",e);try{const t=await fetch("https://app.rapidfunnel.com/api/mail/send-cta-email",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)});if(t.ok){const e=await t.json();return console.log("CTA notification sent successfully",e),e}{let e="Could not read error response.";try{e=await t.json()}catch(e){console.warn("Could not parse error response body as JSON.")}console.error(`CTA notification failed: ${t.status} ${t.statusText}`,e)}}catch(e){console.error("Error sending CTA notification:",e)}}async function n(e){if(!e)return console.warn("Invalid or missing contactId for fetching details."),null;const t=`https://apiv2.rapidfunnel.com/v2/contact-details/${e}`;console.log(`Fetching contact details for ID: ${e}`);try{const e=await fetch(t);if(!e.ok)return console.error(`Failed to fetch contact details: ${e.status} ${e.statusText}`),null;const o=await e.json();return o&&o.data?(console.log("Contact details fetched successfully:",o.data),o.data):(console.warn("Contact details response format unexpected:",o),null)}catch(e){return console.error("Error fetching contact details:",e),null}}const a=window.rapidFunnelPageName||window.location.pathname,i=document.querySelectorAll("a, button");0!==i.length?(console.log(`Found ${i.length} potential trackable elements (links/buttons). Initializing tracking...`),i.forEach((i=>{i.addEventListener("click",(async c=>{const r=function(e){let t=e.getAttribute("data-description")||e.getAttribute("aria-label")||e.innerText||e.textContent;return"BUTTON"===e.tagName&&(t=t||e.value||e.name),t=t?t.trim():"",t||(t="A"===e.tagName?"Unnamed Link":"Unnamed Button"),t.length>100&&(t=t.substring(0,97)+"..."),t}(i);if(console.log(`Click detected on ${i.tagName}: "${r}"`),t.userId&&t.resourceId){if("BUTTON"===i.tagName){if("submit"===i.type||!i.hasAttribute("type")&&i.closest("form")){console.log("[Submit Button] Click detected."),c.preventDefault(),console.log("[Submit Button] Default action prevented.");const e=function(){const e={firstNameInput:null,lastNameInput:null,nameInput:null,emailInput:null,phoneInput:null};e.emailInput=document.querySelector('input[type="email"]'),e.phoneInput=document.querySelector('input[type="tel"]');const t={firstName:[/first.?name/i,/fname/i,/first_name/i,/first-name/i,/firstname/i],lastName:[/last.?name/i,/lname/i,/surname/i,/last_name/i,/last-name/i],name:[/^name$/i,/full.?name/i,/your.?name/i],email:[/e.?mail/i],phone:[/phone/i,/mobile/i,/contact.?number/i]},o=["id","name","class","placeholder","aria-label"],n=new Set,a=document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="hidden"], textarea');for(const i in t){const c=`${i}Input`;e[c]&&"email"!==i&&"phone"!==i||t[i].some((t=>Array.from(a).some((a=>!n.has(a)&&o.some((o=>{const r=a.getAttribute(o);return!(!r||!t.test(r)||"email"===i&&e.emailInput===a||"phone"===i&&e.phoneInput===a||(e[c]=a,n.add(a),0))}))))))}return e.emailInput||e.phoneInput?(console.log("Identified potential contact inputs on the page:",e),e):(console.log("Could not find trackable inputs (email or phone) anywhere on the page."),null)}();if(e){console.log("[Submit Button] Found trackable inputs on page.");const{firstNameInput:o,lastNameInput:n,nameInput:a,emailInput:c,phoneInput:r}=e,s=c?.value?.trim(),l=r?.value?.trim();if(!s&&!l)return void console.warn("[Submit Button] Submission stopped: Missing both email and phone value on page.");if(s&&!/\S+@\S+\.\S+/.test(s))return void console.warn("[Submit Button] Submission stopped: Invalid email format.");let d="",u="";if(o?.value&&n?.value)d=o.value.trim(),u=n.value.trim();else if(a?.value){const e=a.value.trim().split(/\s+/);d=e.shift()||"",u=e.join(" ")}else o?.value?d=o.value.trim():n?.value&&(d=n.value.trim());const m={};d&&(m.firstName=d),u&&(m.lastName=u),s&&(m.email=s),l&&(m.phone=l),m.campaign=window.rapidFunnelCampaignId||0,m.contactTag=window.rapidFunnelLabelId||0;const g=new URLSearchParams(m).toString(),p=Number(t.resourceId),f=Number(t.userId);i.disabled=!0,console.log("[Submit Button] Disabled.");const h=await async function(e,t,o){const n="https://my.rapidfunnel.com/landing/resource/create-custom-contact",a=new URLSearchParams;a.append("formData",e),a.append("resourceId",t),a.append("senderId",o);let i="customPage";i.startsWith("file://")&&(i="customPage"),a.append("sentFrom",i);const c=a.toString();console.log("Submitting page contact data to:",n),console.log("Request Body (URL-encoded):",c);try{const e=await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json, text/javascript, */*; q=0.01"},body:c});if(!e.ok){let t="Could not read error response.";try{t=await e.json()}catch(e){}return console.error(`Contact data submission failed: ${e.status} ${e.statusText}`,t),null}const t=await e.json();console.log("Contact data submitted successfully:",t);const o=t.contactId||null;return!o||o<=0?(console.error("Submission successful but no valid contactId received.",t),null):o}catch(e){return console.error("Error submitting contact data:",e),null}}(g,p,f),I=i.getAttribute("data-redirect");let b=!1;if(h&&I){console.log("[Submit Button] Redirect URL found on button:",I);try{const e=new URL(I,window.location.origin);e.searchParams.set("userId",String(f)),e.searchParams.set("resourceId",String(p)),e.searchParams.set("contactId",String(h)),console.log("[Submit Button] Redirecting to:",e.toString()),window.location.href=e.toString(),b=!0}catch(e){console.error("[Submit Button] Error constructing redirect URL:",e)}}else h?console.log("[Submit Button] Submission successful, but no data-redirect found on button. Staying on page."):console.warn("[Submit Button] Submission failed or returned invalid contactId.");b||(console.log("[Submit Button] Re-enabling button."),i.disabled=!1)}else console.warn("[Submit Button] Clicked, but no trackable inputs (email/phone) found on the page. No action taken.")}else{console.log("[CTA Button] Click detected.");let c={legacyUserId:Number(t.userId),contactFirstName:"N/A",contactLastName:"N/A",contactPhoneNumber:"N/A",contactEmail:"N/A",ctaLocation:r,ctaPageName:a};if(t.contactId){const e=await n(t.contactId);e?(c.contactFirstName=e.firstName||"N/A",c.contactLastName=e.lastName||"N/A",c.contactPhoneNumber=e.phone||"N/A",c.contactEmail=e.email||"N/A"):(c.contactFirstName="System failed to retrieve",c.contactLastName=`Contact ID: ${t.contactId}`)}else c.contactFirstName="No contact ID found";const s=o(c),l=i.getAttribute("data-href"),d=i.getAttribute("data-target")||"_self";if(l){console.log("[CTA Button] Found data-href, will redirect after notification attempt.");try{await s}catch(e){}e(l,d)}else console.log("[CTA Button] No data-href found. Allowing default button action (if any) after notification attempt.")}}else if("A"===i.tagName){console.log("[CTA Link] Click detected."),c.preventDefault(),console.log("[CTA Link] Default navigation prevented.");const s=i.getAttribute("href"),l=i.getAttribute("target")||"_self";let d={legacyUserId:Number(t.userId),contactFirstName:"N/A",contactLastName:"N/A",contactPhoneNumber:"N/A",contactEmail:"N/A",ctaLocation:r,ctaPageName:a};if(t.contactId){const e=await n(t.contactId);e?(d.contactFirstName=e.firstName||"N/A",d.contactLastName=e.lastName||"N/A",d.contactPhoneNumber=e.phone||"N/A",d.contactEmail=e.email||"N/A"):(d.contactFirstName="System failed to retrieve",d.contactLastName=`Contact ID: ${t.contactId}`)}else d.contactFirstName="No contact ID found";try{console.log("[CTA Link] Sending notification..."),await o(d),console.log("[CTA Link] Notification sent (or attempt finished).")}catch(e){console.error("[CTA Link] Notification sending failed (error caught).",e)}finally{console.log("[CTA Link] Proceeding to redirect."),e(s,l)}}}else console.warn("Skipping action: Missing userId or resourceId in URL params.")}))}))):console.log("No trackable links or buttons found.")}function o(){console.log("Running initialization logic...");const e=function(){const e=new URLSearchParams(window.location.search);return{userId:e.get("userId"),resourceId:e.get("resourceId"),contactId:e.get("contactId")}}();console.log("URL Parameters:",e),function(e){const{userId:t,contactId:o}=e;document.querySelectorAll("[href]").forEach((e=>{let n=e.href,a=!1;t&&n.includes("[user-id]")&&(n=n.replace(/\[user-id\]/g,t),a=!0),n.includes("[customer-id]")&&(n=n.replace(/\[customer-id\]/g,o||""),a=!0),a&&(e.href=n,console.log(`Updated URL: ${e.href}`))})),document.querySelectorAll("[src]").forEach((e=>{let n=e.src,a=!1;t&&n.includes("[user-id]")&&(n=n.replace(/\[user-id\]/g,t),a=!0),n.includes("[customer-id]")&&(n=n.replace(/\[customer-id\]/g,o||""),a=!0),a&&(e.src=n,console.log(`Updated source: ${e.src}`))})),document.querySelectorAll("*").forEach((e=>{Array.from(e.attributes).forEach((n=>{if(n.name.startsWith("data-")&&"string"==typeof n.value){let a=n.value,i=!1;t&&a.includes("[user-id]")&&(a=a.replace(/\[user-id\]/g,t),i=!0),a.includes("[customer-id]")&&(a=a.replace(/\[customer-id\]/g,o||""),i=!0),i&&(e.setAttribute(n.name,a),console.log(`Updated data attribute: ${n.name}`))}}))}))}(e);try{t(e)}catch(e){console.error("Failed to initialize CTA tracking:",e)}try{!function(e){function t(e){if(void 0!==window._wq)return console.log("Wistia API already available"),void e();console.log("Waiting for Wistia API to load...");let t=setInterval((()=>{void 0!==window._wq&&(clearInterval(t),console.log("Wistia API loaded"),e())}),100);setTimeout((()=>{clearInterval(t),console.warn("Wistia API failed to load after 10 seconds")}),1e4)}async function o(e){try{const t=await fetch("https://my.rapidfunnel.com/landing/resource/push-to-sqs",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"},body:new URLSearchParams(e).toString()});if(!t.ok)return void console.error(`Video tracking submission failed: ${t.status} ${t.statusText}`);const o=t.headers.get("content-type");if(o&&o.includes("application/json")){const e=await t.json();console.log("Video tracking submitted successfully:",e)}else console.log("Video tracking submitted successfully")}catch(e){console.error("Error sending video tracking data:",e)}}console.log("Initializing Video Tracking...",e),new Promise(((e,o)=>{if(void 0!==window._wq)return console.log("Wistia API already loaded"),void e();if(document.querySelector('script[src*="wistia.com/assets/external/E-v1.js"]'))return console.log("Wistia script already loading"),void t(e);console.log("Loading Wistia script...");const n=document.createElement("script");n.src="https://fast.wistia.com/assets/external/E-v1.js",n.async=!0,n.onload=()=>{console.log("Wistia script loaded successfully"),t(e)},n.onerror=e=>{console.error("Failed to load Wistia script:",e),o(new Error("Failed to load Wistia script"))},document.head.appendChild(n)})).then((()=>{window._wq=window._wq||[],window._wq.push({_all:function(t){console.log("Wistia video found:",t.hashedId()),t.bind("play",(()=>{console.log("Video play event detected for:",t.hashedId());const{userId:n,resourceId:a,contactId:i}=e,c=e=>e&&/^[0-9]+$/.test(e);c(n)&&c(i)?o({resourceId:a,contactId:i,userId:n,percentageWatched:0,mediaHash:t.hashedId(),duration:t.duration(),visitorKey:t.visitorKey(),eventKey:t.eventKey(),delayProcess:1,webinar:""}):console.warn("Cannot track video play: Missing or non-numeric userId, resourceId, or contactId in URL params.")}));const n=[25,50,75,100];let a=0,i=!1;t.bind("end",(()=>{if(console.log(`Video ${t.hashedId()} ended, resetting progress tracking`),a<100){const{userId:n,resourceId:a,contactId:i}=e;o({resourceId:a,contactId:i,userId:n,percentageWatched:1,mediaHash:t.hashedId(),duration:t.duration(),visitorKey:t.visitorKey(),eventKey:t.eventKey(),delayProcess:1,webinar:""})}a=0,i=!0})),t.bind("pause",(()=>{console.log(`Video ${t.hashedId()} paused at ${Math.round(t.time()/t.duration()*100)}%`)})),t.bind("play",(()=>{i=!1})),t.bind("timechange",(()=>{if(i)return;const c=t.time(),r=t.duration();if(!r||isNaN(c)||isNaN(r))return;const s=Math.min(100,Math.max(0,Math.round(c/r*100)));for(const i of n)if(s>=i&&a<i){console.log(`Video ${t.hashedId()} reached ${i}% watched (current: ${s}%, last reported: ${a}%)`);const{userId:n,resourceId:c,contactId:r}=e;o({resourceId:c,contactId:r,userId:n,percentageWatched:i/100,mediaHash:t.hashedId(),duration:t.duration(),visitorKey:t.visitorKey(),eventKey:t.eventKey(),delayProcess:1,webinar:""}),a=i;break}}))}}),console.log("Wistia video tracking initialized. Waiting for play events...")})).catch((e=>{console.error("Failed to initialize Wistia tracking:",e)}))}(e)}catch(e){console.error("Failed to initialize video tracking:",e)}try{e.contactId&&console.log("Contact ID found in URL, ensuring form buttons track as CTAs.",e.contactId)}catch(e){console.error("Error handling form with existing contact:",e)}}if(console.log("RapidFunnel Tracker: Script file executing..."),"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll)console.log("DOM ready on initial check (readyState). Running initializers."),o();else if(document.body)console.log("DOM body found on initial check. Running initializers."),o();else{console.log("DOM not ready, setting up interval check for document.body.");let e=null,t=50;const n=()=>{t--,(document.body||t<=0)&&(console.log(t>0?"document.body found by polling.":"Polling timeout reached."),clearInterval(e),window.rfTrackerInitialized||(window.rfTrackerInitialized=!0,o()))};document.addEventListener("DOMContentLoaded",(()=>{console.log("DOMContentLoaded event fired (fallback)."),clearInterval(e),window.rfTrackerInitialized||(window.rfTrackerInitialized=!0,o())})),e=setInterval(n,100)}}();